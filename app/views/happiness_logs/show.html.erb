<% content_for(:navbar) do %>
  <section class="navbar"></section>
<% end %>

<img src="/images/cloud1.png" class="cloud_title">
<h1 align="center" class="show_cloud_title_text"> Post Data: </h1>
<br><br><br><br>
<%= Demographic.compare_age_ranges(5, 25, 15, 65) %> 
<h5>  Add Posts to See More Accurate Data </h5>

<img src="/images/cloud1.png" class="show_cloud_chart2">
<p class="show_cloud_chart1_text">Personal Happiness Timeline</p>

<div class="show_chart1" id='chart_div' style='width: 700px; height: 700px;'></div>

<div class="show_chart2" id="map_div" style="width: 700px; height: 700;"></div>

<img src="/images/cloud1.png" class="show_cloud_chart1">
<p class="show_cloud_chart2_text">Personal Happiness Map</p>

<div class="show_chart2_buttons">
  <%= simple_form_for(@location) do |r| %>
    <%= r.select(:region, IsoCountryCodes.for_select) %>
    <%= r.submit "Change Location" %>
  <% end %>

  <%= simple_form_for(@location) do |r| %>
    <%= r.hidden_field :region, value: "world" %>
    <%= r.submit "See World" %>
  <% end %>
</div>

<div class="show_scales">
  <img src="/images/scale.png" class="show_scale1">
  <img src="/images/scale.png" class="show_scale2">
</div>

<img src="/images/cloud1.png" class="show_cloud_chart3">
<p class="show_cloud_chart3_text">Factors Mentioned</p>

<div class="show_chart3" id="donutchart" style="width: 700; height: 700px;"></div>

<div class="scroll_container2">
  <% unless @happiness_log.image == "Add Image" || @happiness_log.image.blank? %>
    <%= filepicker_image_tag @happiness_log.image, w: 400, h: 400, fit: 'clip', class: 'center' %>
    <%= filepicker_save_button "Save", @happiness_log.image, "image/jpg" %>
  <% end %>

  <p>
    <strong>Main Post:</strong>
    <%= @happiness_log.main_post %>
  </p>

  <% unless @response.nil? %>
    <h1><%= @response.body["face"] %></h1>
  <% end %>

  <p>
    <strong>Happiness Logs:</strong>
    <%= @happiness_logs.map(&:serializable_hash)%>
  </p>

  <p>
    <strong>Happy:</strong>
    <%= @happiness_log.happy_scale %>
  </p>

  <p>
    <strong>Smile:</strong>
    <%= @happiness_log.smile %>
  </p>

  <%= link_to 'Edit', edit_happiness_log_path(@happiness_log) %> |
  <%= link_to 'Back', happiness_logs_path %>
</div>

<script type='text/javascript' src='jsapi'></script>
<script type='text/javascript'>
  google.load('visualization', '1', {'packages':['annotatedtimeline']});
  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = new google.visualization.DataTable();
    data.addColumn('datetime', 'Date');
    data.addColumn('number', 'Happiness');   
    data.addColumn('number', 'Image Analysis');
    data.addColumn('string', 'Post');

    var date = gon.date;
    var happiness_log = gon.happiness_logs;
    happiness_log.forEach( function (arrayItem) {
      for (var i in date) {
        data.addRows([
         [new Date(Date.parse(date[i])), arrayItem['happy_scale'], arrayItem['smile_scale'], arrayItem['main_post']]
         ]);
      }
    });

    var options = {
      colors: ['#e0440e', '#FFCC00'],
      displayAnnotations: true,
      max: 10,
      fill: 10,
      wmode: 'opaque',
      thickness: 2,
      displayAnnotations: true,
    };

    var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('chart_div'));

    chart.draw(data, options);
  }
</script>

<script type="text/javascript">
  google.load('visualization', '1', {'packages': ['geochart']});
  google.setOnLoadCallback(drawMarkersMap);

  function drawMarkersMap() {
  var happiness_log = gon.happiness_logs;
  var data = google.visualization.arrayToDataTable([['Location']]);
  data.addColumn('number', 'Happy Scale');   

  happiness_log.forEach( function (arrayItem) {
     data.addRows([
       [arrayItem['address'], arrayItem['happy_scale']]
     ]);
  });

  var options = {
    region: gon.region,
    displayMode: 'markers',
    colorAxis: {colors: ['blue', 'red']}
  };

  var chart = new google.visualization.GeoChart(document.getElementById('map_div'));
  chart.draw(data, options);
  };
</script>

<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable(
      [['Factors Mentioned (Scaled From 1-10)']]);
    data.addColumn('number', 'Scale')
    
    var happiness_log = gon.current_happiness_log

    data.addRows([
      ['Health', happiness_log['health_scale']],
      ['Wealth', happiness_log['wealth_scale']],
      ['Culture', happiness_log['culture_scale']],
      ['Location', happiness_log['location_scale']],
      ['Spirituality', happiness_log['spirituality_scale']],
      ['Relationship', happiness_log['relationship_scale']],
      ['Activity', happiness_log['activity_scale']],
      ['Passion', happiness_log['passion_scale']],
      ['Satisfaction', happiness_log['satisfaction_scale']],
      ['Self-View', happiness_log['self_view_scale']]         
    ]);

    var options = {
      title: 'Factors Mentioned',
      pieHole: 0.4,
    };

    var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
    chart.draw(data, options);
  }
</script>
